<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkyCanvas ‚Äî Creative Weather</title>
  <style>
    /* Reset + base */
    :root{
      --bg1: #0f1724;
      --bg2: #0b2238;
      --glass: rgba(255,255,255,0.06);
      --accent: #7bd389;
      --muted: rgba(255,255,255,0.7);
      --card-radius: 18px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(123,211,137,0.06), transparent),
                  radial-gradient(800px 400px at 90% 90%, rgba(123,168,255,0.04), transparent),
                  linear-gradient(180deg,var(--bg1),var(--bg2));
      color:white;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:20px;
      min-height:100vh;
      flex-direction:column;
    }

    /* App wrapper */
    .app {
      width: min(980px, 96%);
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:start;
    }

    /* Left: main interactive card */
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius: var(--card-radius);
      padding:24px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.04);
      min-height:420px;
      position:relative;
      overflow:hidden;
    }

    /* Decorative floating shapes */
    .panel::before, .panel::after{
      content:"";
      position:absolute;
      border-radius:50%;
      filter: blur(60px);
      opacity:0.55;
      transform: translateZ(0);
      pointer-events:none;
    }
    .panel::before{
      width:320px;height:320px; right:-80px; top:-80px;
      background: linear-gradient(120deg, rgba(123,211,137,0.12), rgba(123,168,255,0.06));
    }
    .panel::after{
      width:180px;height:180px; left:-30px; bottom:-40px;
      background: linear-gradient(120deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    }

    .header {
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:12px;
    }
    .logo {
      width:56px;height:56px;border-radius:12px;
      display:grid;place-items:center;font-weight:700;
      background: linear-gradient(135deg,#9be7c5,#79b9ff);
      color:#032027;font-size:20px;
      box-shadow: 0 6px 18px rgba(10,20,30,0.4);
    }
    .title h1{margin:0;font-size:18px}
    .title p{margin:0;font-size:12px;color:var(--muted)}

    /* Search */
    .search {
      display:flex;
      gap:10px;
      margin:18px 0;
      align-items:center;
    }
    .search input{
      flex:1;background:transparent;border:1px solid rgba(255,255,255,0.06);
      padding:12px 14px;border-radius:12px;color:inherit;outline:none;
      font-size:15px;
      transition: box-shadow .18s, border-color .18s;
      backdrop-filter: blur(6px);
    }
    .search input:focus{
      border-color: rgba(123,211,137,0.9);
      box-shadow: 0 6px 18px rgba(123,211,137,0.08);
    }
    .btn{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.06);
      padding:10px 14px;border-radius:12px;color:var(--muted);
      cursor:pointer;font-weight:600;
    }
    .btn.primary{
      background: linear-gradient(90deg,#7bd389,#79b9ff);
      color:#032027;border:none;
      box-shadow: 0 8px 24px rgba(30,100,80,0.08);
    }
    .small {
      font-size:12px;padding:8px 10px;border-radius:10px;
    }

    /* Weather card */
    .weather {
      display:flex;
      gap:18px;
      align-items:center;
      margin-top:6px;
    }
    .weather .left{
      display:flex;flex-direction:column;gap:6px;
      min-width:220px;
    }
    .temp{
      font-size:56px;font-weight:700;line-height:0.9;
      display:flex;align-items:center;gap:10px;
    }
    .condition{
      font-size:16px;color:var(--muted);
    }
    .icon{
      width:120px;height:120px;display:grid;place-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;border:1px solid rgba(255,255,255,0.03);
    }
    .meta{
      display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;
    }
    .meta .chip{
      background:var(--glass); padding:8px 10px;border-radius:12px;font-size:13px;
      border:1px solid rgba(255,255,255,0.02);
    }

    /* Right column: trends / tips */
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--card-radius); padding:18px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.5); border:1px solid rgba(255,255,255,0.04);
      min-height:420px;
    }
    .panel-title{font-weight:700;margin-bottom:8px}
    .aqi{font-size:13px;color:var(--muted);margin-bottom:12px}
    .tips{display:flex;flex-direction:column;gap:12px}
    .tip{
      background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(255,255,255,0.02));
      padding:12px;border-radius:12px;font-size:13px;
      border:1px solid rgba(255,255,255,0.02);
    }

    /* footer small */
    .muted-small{font-size:12px;color:var(--muted);margin-top:14px}

    /* Status / messages */
    .status{
      position:absolute;left:50%;transform:translateX(-50%);bottom:18px;
      background:rgba(0,0,0,0.36);padding:10px 14px;border-radius:14px;font-size:13px;
      border:1px solid rgba(255,255,255,0.03);
      display:flex;gap:8px;align-items:center;
    }

    /* Responsive */
    @media (max-width:960px){
      .app{grid-template-columns:1fr;align-items:stretch}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="panel" id="mainPanel" aria-live="polite">
      <div class="header">
        <div class="logo">SC</div>
        <div class="title">
          <h1>SkyCanvas</h1>
          <p>Creative, clear weather ‚Äî search any location</p>
        </div>
      </div>

      <div class="search" role="search">
        <input id="locationInput" placeholder="Type city / postal code / 'auto' / 'lat,long' (e.g. Mumbai or 19.07,72.87)" aria-label="Location input"/>
        <button class="btn primary" id="searchBtn">Search</button>
        <button class="btn small" id="geoBtn" title="Use your device location">üìç</button>
      </div>

      <div class="weather" id="weatherCard" style="display:none">
        <div class="left">
          <div class="temp" id="tempBlock">--¬∞ <button id="toggleUnit" class="btn small" title="Toggle ¬∞C/¬∞F">¬∞C</button></div>
          <div class="condition" id="conditionText">‚Äî</div>

          <div class="meta" id="metaChips">
            <!-- chips inserted here -->
          </div>
        </div>

        <div class="icon" id="iconBlock" aria-hidden="true">
          <!-- icon image -->
        </div>
      </div>

      <div class="muted-small" id="locationLabel">Enter a location and press Search ‚Äî or try "auto".</div>

      <div class="status" id="status" style="display:none">Ready</div>
    </div>

    <aside class="sidebar" id="sidebar">
      <div class="panel-title">Air Quality & Tips</div>
      <div class="aqi" id="aqiText">AQI: ‚Äî</div>

      <div class="tips" id="tipsList">
        <div class="tip">Search a location to see current weather, temperature, wind, humidity and AQI where available.</div>
        <div class="tip">Click the üìç button to let the browser supply your coordinates (permission required).</div>
      </div>

      <div class="muted-small" style="margin-top:12px">Powered by WeatherAPI</div>
    </aside>
  </div>

  <script>
    // URL template from user
    const API_BASE = "http://api.weatherapi.com/v1/current.json";
    // You gave this full URL earlier; we will extract the key so the user can re-use/update easily.
    // Provided key (as in your message): 25e3b306b9a44f19a87172913252111
    const API_KEY = "25e3b306b9a44f19a87172913252111";

    const locationInput = document.getElementById('locationInput');
    const searchBtn = document.getElementById('searchBtn');
    const geoBtn = document.getElementById('geoBtn');
    const weatherCard = document.getElementById('weatherCard');
    const tempBlock = document.getElementById('tempBlock');
    const conditionText = document.getElementById('conditionText');
    const iconBlock = document.getElementById('iconBlock');
    const metaChips = document.getElementById('metaChips');
    const locationLabel = document.getElementById('locationLabel');
    const status = document.getElementById('status');
    const aqiText = document.getElementById('aqiText');
    const tipsList = document.getElementById('tipsList');
    const toggleUnitBtn = document.getElementById('toggleUnit');

    let currentData = null;
    let unitCelsius = true;

    // Helpers
    function showStatus(msg){
      status.style.display = 'flex';
      status.textContent = msg;
    }
    function hideStatus(){
      status.style.display = 'none';
    }

    function setError(msg){
      showStatus(msg);
      setTimeout(hideStatus, 3500);
    }

    function clearDisplay(){
      weatherCard.style.display = 'none';
      metaChips.innerHTML = '';
      iconBlock.innerHTML = '';
      locationLabel.textContent = 'Enter a location and press Search ‚Äî or try "auto".';
      aqiText.textContent = 'AQI: ‚Äî';
      currentData = null;
    }

    function formatTemp(temp_c, temp_f){
      return unitCelsius ? Math.round(temp_c) + "¬∞C" : Math.round(temp_f) + "¬∞F";
    }

    function buildMeta(data){
      metaChips.innerHTML = '';

      const addChip = (label, val) => {
        const d = document.createElement('div');
        d.className = 'chip';
        d.textContent = label + ": " + val;
        metaChips.appendChild(d);
      };

      addChip('Feels like', formatTemp(data.current.feelslike_c, data.current.feelslike_f));
      addChip('Wind', data.current.wind_kph + ' kph');
      addChip('Humidity', data.current.humidity + '%');
      addChip('Cloud', data.current.cloud + '%');
      addChip('Local time', data.location.localtime);
    }

    function setBackgroundFromCondition(cond, is_day){
      // Simple background shift depending on condition keywords
      const app = document.body;
      cond = cond.toLowerCase();

      if(!is_day) {
        app.style.background = "linear-gradient(180deg,#071021,#081726)";
      } else if (cond.includes('rain') || cond.includes('shower') || cond.includes('drizzle') ){
        app.style.background = "linear-gradient(180deg,#0b2638,#06324a)";
      } else if (cond.includes('cloud') || cond.includes('overcast')){
        app.style.background = "linear-gradient(180deg,#1b2a36,#12202a)";
      } else if (cond.includes('snow') || cond.includes('sleet')){
        app.style.background = "linear-gradient(180deg,#e6f0ff,#cfe8ff)";
        document.documentElement.style.setProperty('--muted','rgba(0,0,20,0.7)');
      } else if (cond.includes('sun') || cond.includes('clear')){
        app.style.background = "linear-gradient(180deg,#0077ff,#9be7c5)";
      } else {
        app.style.background = "linear-gradient(180deg,var(--bg1),var(--bg2))";
      }
    }

    function renderWeather(data){
      currentData = data;
      weatherCard.style.display = 'flex';
      const tempText = formatTemp(data.current.temp_c, data.current.temp_f);
      tempBlock.innerHTML = `${tempText} <button id="toggleUnit" class="btn small" title="Toggle ¬∞C/¬∞F">${unitCelsius ? '¬∞C' : '¬∞F'}</button>`;

      // Rebind toggle (since innerHTML replaced it)
      document.getElementById('toggleUnit').addEventListener('click', () => {
        unitCelsius = !unitCelsius;
        renderWeather(currentData);
      });

      conditionText.textContent = `${data.current.condition.text} ‚Äî ${data.location.name}, ${data.location.region || data.location.country}`;
      // icon
      const iconUrl = data.current.condition.icon.startsWith('http') ? data.current.condition.icon : 'https:' + data.current.condition.icon;
      iconBlock.innerHTML = `<img src="${iconUrl}" alt="${data.current.condition.text}" width="96" height="96" style="display:block"/>`;

      buildMeta(data);

      locationLabel.textContent = `Last updated: ${data.location.localtime}`;

      // AQI
      if (data.current.air_quality){
        // WeatherAPI returns AQI in multiple fields (us-epa-index, gb-defra-index or pollutant concentrations). We'll try to show a compact summary.
        const aq = data.current.air_quality;
        // A small human-friendly AQI display:
        const us = Math.round(aq['us-epa-index'] || aq['us-epa-index']);
        aqiText.textContent = `AQI (US EPA index): ${us}`;
      } else {
        aqiText.textContent = 'AQI: not available';
      }

      setBackgroundFromCondition(data.current.condition.text, data.current.is_day === 1);

      hideStatus();
    }

    // Fetch weather from API
    async function fetchWeather(query){
      try {
        showStatus('Fetching weather...');
        // allow queries like "auto" to let the API resolve by IP
        const q = query.trim() || 'auto';
        const url = `${API_BASE}?key=${API_KEY}&q=${encodeURIComponent(q)}&aqi=yes`;

        const res = await fetch(url);
        if (!res.ok){
          // WeatherAPI uses 400/401 for errors; parse JSON if possible
          let errText = 'Failed to fetch';
          try {
            const err = await res.json();
            errText = err.error && err.error.message ? err.error.message : JSON.stringify(err);
          } catch(e){
            errText = res.status + ' ' + res.statusText;
          }
          clearDisplay();
          setError('Error: ' + errText);
          return;
        }
        const data = await res.json();
        renderWeather(data);
      } catch (err){
        clearDisplay();
        setError('Network error. Check connection or CORS.');
        console.error(err);
      }
    }

    // Event listeners
    searchBtn.addEventListener('click', () => {
      fetchWeather(locationInput.value || 'auto');
    });

    locationInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter'){
        fetchWeather(locationInput.value || 'auto');
      }
    });

    geoBtn.addEventListener('click', () => {
      if (!navigator.geolocation){
        setError('Geolocation not supported by browser.');
        return;
      }
      showStatus('Getting device location...');
      navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude.toFixed(5);
        const lon = pos.coords.longitude.toFixed(5);
        fetchWeather(`${lat},${lon}`);
      }, (err) => {
        setError('Permission denied or geolocation failed.');
      }, {timeout:9000});
    });

    // On load: if user typed nothing and clicks search, we'll try auto (IP-based)
    // Small nicety: try to show a sample default for demonstration (London) but do NOT auto-call; user asked to input location.
    // Provide a sample placeholder:
    locationInput.placeholder = "Try: Mumbai, London, Tokyo or 'auto' or '19.07,72.87'";

    // Accessibility: announce ready
    showStatus('Ready ‚Äî enter a location');

    // Optional: quick demo button by double-click on logo (for users testing)
    document.querySelector('.logo').addEventListener('dblclick', ()=> {
      // demo: show London weather quickly
      fetchWeather('London');
    });

    // Note: if you host this on a server with HTTPS, consider using the HTTPS endpoint:
    // e.g. replace API_BASE with "https://api.weatherapi.com/v1/current.json"
    // Many browsers block mixed content (HTTPS page making HTTP request). If you open this file via file:// it should work,
    // but if you host the page at https://, change API_BASE to https://api.weatherapi.com/v1/current.json
  </script>
</body>
</html>

